@page "/cart"
@rendermode InteractiveServer
@inject CartService CartService
@inject NavigationManager Nav

<div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Giỏ hàng</h5>
        <a href="/shopping" class="btn btn-outline-secondary">Quay lại mua sắm</a>
    </div>

    <div class="card-body">
        @if (!CartService.Items.Any())
        {
            <p class="text-center text-muted">Giỏ hàng trống</p>
        }
        else
        {
            <table class="table table-bordered align-middle">
                <thead class="table-light">
                    <tr>
                        <th>STT</th>
                        <th>Sản phẩm</th>
                        <th>Giá</th>
                        <th class="text-center">Số lượng</th>
                        <th>Thành tiền</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        int i = 1;
                        foreach (var item in CartService.Items)
                        {
                            <tr>
                                <td>@i</td>
                                <td>@item.Product?.ProductName</td>
                                <td>@item.Price.ToString("N0") đ</td>
                                <td class="text-center">
                                    <button class="btn btn-sm btn-outline-danger me-2"
                                            @onclick="() => Decrease(item.ProductId!.Value)">
                                        −
                                    </button>

                                    <strong>@item.Quantity</strong>

                                    <button class="btn btn-sm btn-outline-success ms-2"
                                            @onclick="() => Increase(item.ProductId!.Value)">
                                        +
                                    </button>
                                </td>
                                <td>@item.Subtotal.ToString("N0") đ</td>
                            </tr>
                            i++;
                        }
                    }
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4" class="text-end fw-bold">Tổng tiền</td>
                        <td class="fw-bold">@CartService.TotalAmount.ToString("N0") đ</td>
                    </tr>
                </tfoot>
            </table>

            <a href="/payment" class="btn btn-outline-secondary">Thanh toán</a>
            <button class="btn btn-secondary ms-2" @onclick="ClearCart">
                Xóa giỏ
            </button>
        }
    </div>
</div>

@code {
    void Increase(int productId)
    {
        CartService.Increase(productId);
        StateHasChanged();
    }

    void Decrease(int productId)
    {
        CartService.Decrease(productId);
        StateHasChanged();
    }

    void ClearCart()
    {
        CartService.Clear();
        StateHasChanged();
    }
}
